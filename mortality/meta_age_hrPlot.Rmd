---
title: "Supplementary: Plot of hazard ratios by neuroticism and conscientiousness (age as model metric)"

output: html_document
---
This document contains the hazard ratio plots of the surivival models, using age since baseline as the metric of interest and neuroticism by conscientiousness as the predictor of interest.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(knitr.kable.NA = '')
```

The following packages were used to generate this table: 

```{r load_packages, warning = FALSE, message = FALSE, results = 'hide'}
library(papaja)
library(tidyverse)
library(knitr)
library(kableExtra)
```

Specify the location of the study analysis objects. The first author stored these in a Box Sync folder, but you may have downloaded these to a different location. The files needed for this table are available at [osf.io/mzfu9](https://osf.io/mzfu9/) in the Individual Study Output folder.

```{r}
data.path = c("../study output/")
```

First we load the individual study analysis objects.

```{r, results = 'hide'}
study.names = c("EAS", "HRS", "LBC", "LBLS", "MAP", "MAS", "MIDUS", "NAS", "OATS", "ROS", "SLS", "WLS")

lapply(paste0(data.path, study.names, "_survival_output.Rdata"), load, .GlobalEnv)
```

Next we extract the predicted values from each object.

```{r}
plotage = lapply(paste0(study.names, "_survival_output"), 
                  FUN = function(x) get(x)$plotdata$age) %>%
  map2_df(., study.names, ~ mutate(.x, study = .y))

plot_n = data.frame(study = study.names,
                    n = sapply(paste0(study.names, "_survival_output"), 
                  FUN = function(x) get(x)$age$model2$ntotal))

plotage = plotage %>%
  full_join(plot_n)
```

Finally, we plot individual values, as well as the overall weighted line. 

```{r}
plotage %>%
  mutate(study = gsub("LBC", "LBC1936", study)) %>%
  ggplot(aes(x = z.neur, y = fit)) +
  geom_line(aes(color = study), linetype = "dashed") +
  stat_smooth(aes(weight = n),
              method = "lm",
              formula = y ~ x,
              se =  TRUE,
              size = 1, color = "black") + 
  scale_x_continuous("Neuroticism (standardized within study)") +
  scale_y_continuous("Hazard ratio") +
  facet_wrap(~z.con) + 
  theme_bw() + 
  theme(legend.position = "bottom")
```


